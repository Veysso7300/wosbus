<!doctype html>
<html lang="tr">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>Wosbus Men√º</title>

    <style>
      :root {
        --bg: #0b0b0b;
        --card: #141414;
        --muted: #a9a9a9;
        --text: #ffffff;
        --accent: #00e5ff;
        --border: rgba(255,255,255,.08);
      }
      * { box-sizing: border-box; }
      body {
        margin: 0;
        font-family: system-ui, -apple-system, Segoe UI, Roboto, Ubuntu, sans-serif;
        background: radial-gradient(1200px 700px at 20% 0%, rgba(0,229,255,.14), transparent 60%),
                    radial-gradient(1000px 600px at 90% 10%, rgba(255,0,122,.10), transparent 55%),
                    var(--bg);
        color: var(--text);
      }
      .wrap { max-width: 1000px; margin: 0 auto; padding: 28px 16px 80px; }
      header {
        display: flex; gap: 12px; align-items: center; justify-content: space-between;
        margin-bottom: 18px;
      }
      .brand {
        display: flex; flex-direction: column; gap: 2px;
      }
      h1 { margin: 0; font-size: 34px; letter-spacing: .2px; }
      .sub { color: var(--muted); font-size: 14px; }

      .actions { display: flex; gap: 10px; align-items: center; }
      .btn {
        border: 1px solid var(--border);
        background: rgba(255,255,255,.04);
        color: var(--text);
        padding: 10px 12px;
        border-radius: 12px;
        text-decoration: none;
        font-size: 14px;
        display: inline-flex; align-items: center; gap: 8px;
      }
      .btn:hover { border-color: rgba(0,229,255,.35); }

      .panel {
        border: 1px solid var(--border);
        background: rgba(255,255,255,.03);
        border-radius: 16px;
        padding: 14px;
        display: grid;
        grid-template-columns: 1fr 180px 180px;
        gap: 10px;
        margin-bottom: 18px;
      }
      input, select {
        width: 100%;
        padding: 12px 12px;
        border-radius: 12px;
        border: 1px solid var(--border);
        background: rgba(0,0,0,.35);
        color: var(--text);
        outline: none;
      }
      input::placeholder { color: rgba(255,255,255,.45); }
      .hint { color: var(--muted); font-size: 12px; margin-top: 6px; }

      .grid { display: grid; gap: 14px; }
      .cat {
        border: 1px solid var(--border);
        background: rgba(255,255,255,.02);
        border-radius: 18px;
        overflow: hidden;
      }
      .catHead {
        padding: 14px 14px;
        display: flex; align-items: center; justify-content: space-between;
        background: linear-gradient(90deg, rgba(0,229,255,.10), rgba(255,0,122,.06));
        border-bottom: 1px solid var(--border);
      }
      .catTitle { font-size: 16px; font-weight: 700; }
      .count { color: var(--muted); font-size: 12px; }

      .items { padding: 10px; display: grid; gap: 10px; }
      .item {
        background: var(--card);
        border: 1px solid var(--border);
        border-radius: 16px;
        padding: 12px 12px;
        display: grid;
        grid-template-columns: 1fr auto;
        gap: 8px;
      }
      .itemTitle { font-weight: 700; font-size: 15px; }
      .itemDesc { color: var(--muted); font-size: 13px; margin-top: 2px; }
      .price {
        align-self: start;
        padding: 8px 10px;
        border-radius: 999px;
        border: 1px solid rgba(0,229,255,.35);
        background: rgba(0,229,255,.08);
        font-weight: 800;
        letter-spacing: .2px;
      }

      .footer {
        margin-top: 18px;
        color: rgba(255,255,255,.55);
        font-size: 12px;
        display: flex; justify-content: space-between; gap: 12px; flex-wrap: wrap;
      }

      .toast {
        position: fixed;
        left: 50%;
        bottom: 18px;
        transform: translateX(-50%);
        background: rgba(0,0,0,.75);
        border: 1px solid var(--border);
        color: var(--text);
        padding: 10px 12px;
        border-radius: 12px;
        font-size: 13px;
        display: none;
        max-width: 92vw;
      }
      .toast.show { display: block; }
    </style>
  </head>

  <body>
    <div class="wrap">
      <header>
        <div class="brand">
          <h1>Wosbus Men√º</h1>
          <div class="sub">G√ºncel men√º ‚Ä¢ hƒ±zlƒ± arama ‚Ä¢ kategori filtre</div>
        </div>
        <div class="actions">
          <a class="btn" href="/admin/" title="Men√ºy√º d√ºzenle">‚úèÔ∏è Admin</a>
          <a class="btn" href="#" id="shareBtn" title="Linki kopyala">üîó Payla≈ü</a>
        </div>
      </header>

      <div class="panel">
        <div>
          <input id="q" placeholder="Ara: espresso, cheesecake..." />
          <div class="hint" id="status">Men√º y√ºkleniyor‚Ä¶</div>
        </div>

        <select id="cat">
          <option value="">T√ºm Kategoriler</option>
          <option>Kahveler</option>
          <option>Tatlƒ±lar</option>
          <option>ƒ∞√ßecekler</option>
          <option>Yiyecekler</option>
        </select>

        <select id="onlyActive">
          <option value="1">Sadece Aktif</option>
          <option value="0">T√ºm√º (aktif+pasif)</option>
        </select>
      </div>

      <div class="grid" id="grid"></div>

      <div class="footer">
        <div>¬© Wosbus</div>
        <div id="meta"></div>
      </div>
    </div>

    <div class="toast" id="toast"></div>

    <script>
      const elGrid = document.getElementById("grid");
      const elQ = document.getElementById("q");
      const elCat = document.getElementById("cat");
      const elOnlyActive = document.getElementById("onlyActive");
      const elStatus = document.getElementById("status");
      const elMeta = document.getElementById("meta");
      const toast = document.getElementById("toast");

      const showToast = (msg) => {
        toast.textContent = msg;
        toast.classList.add("show");
        setTimeout(() => toast.classList.remove("show"), 1600);
      };

      document.getElementById("shareBtn").addEventListener("click", async (e) => {
        e.preventDefault();
        try {
          await navigator.clipboard.writeText(location.href);
          showToast("Link kopyalandƒ± ‚úÖ");
        } catch {
          showToast("Kopyalanamadƒ± (tarayƒ±cƒ± izin vermedi).");
        }
      });

      let rawItems = [];

      function normalize(str) {
        return (str || "").toString().toLowerCase().trim();
      }

      function groupByCategory(items) {
        const map = new Map();
        for (const it of items) {
          const c = it.category || "Diƒüer";
          if (!map.has(c)) map.set(c, []);
          map.get(c).push(it);
        }
        // kategori i√ßi alfabetik
        for (const [k, arr] of map.entries()) {
          arr.sort((a,b) => (a.title || "").localeCompare(b.title || "", "tr"));
        }
        return map;
      }

      function render(items) {
        elGrid.innerHTML = "";

        if (!items.length) {
          elGrid.innerHTML = `<div style="color: rgba(255,255,255,.65); padding: 12px;">
            Sonu√ß yok. Filtreleri deƒüi≈ütir.
          </div>`;
          return;
        }

        const grouped = groupByCategory(items);

        for (const [cat, list] of grouped.entries()) {
          const catEl = document.createElement("section");
          catEl.className = "cat";
          catEl.innerHTML = `
            <div class="catHead">
              <div class="catTitle">${cat}</div>
              <div class="count">${list.length} √ºr√ºn</div>
            </div>
            <div class="items"></div>
          `;

          const itemsEl = catEl.querySelector(".items");

          for (const it of list) {
            const price = (typeof it.price === "number") ? it.price : parseFloat(it.price || 0);
            const itemEl = document.createElement("div");
            itemEl.className = "item";
            itemEl.innerHTML = `
              <div>
                <div class="itemTitle">${it.title || "-"}</div>
                ${it.desc ? `<div class="itemDesc">${it.desc}</div>` : ""}
              </div>
              <div class="price">${price.toFixed(0)}‚Ç∫</div>
            `;
            itemsEl.appendChild(itemEl);
          }

          elGrid.appendChild(catEl);
        }
      }

      function applyFilters() {
        const q = normalize(elQ.value);
        const cat = elCat.value;
        const onlyActive = elOnlyActive.value === "1";

        let items = rawItems.slice();

        if (onlyActive) items = items.filter(x => x.active !== false);

        if (cat) items = items.filter(x => (x.category || "") === cat);

        if (q) {
          items = items.filter(x => {
            const t = normalize(x.title);
            const d = normalize(x.desc);
            const c = normalize(x.category);
            return t.includes(q) || d.includes(q) || c.includes(q);
          });
        }

        render(items);
        elMeta.textContent = `G√∂sterilen: ${items.length} / Toplam: ${rawItems.length}`;
      }

      async function loadMenu() {
        try {
          elStatus.textContent = "Men√º y√ºkleniyor‚Ä¶";
          const res = await fetch("/data/menu.json", { cache: "no-store" });
          if (!res.ok) throw new Error("menu.json okunamadƒ±: " + res.status);
          const data = await res.json();
          rawItems = Array.isArray(data.items) ? data.items : [];
          elStatus.textContent = "Hazƒ±r ‚úÖ";
          applyFilters();
        } catch (e) {
          elStatus.textContent = "Men√º y√ºklenemedi ‚ùå (data/menu.json kontrol et)";
          elGrid.innerHTML = `<div style="color:#ffbdbd; padding: 12px;">
            Men√º y√ºklenemedi. <br/>
            Hata: ${String(e.message || e)}
          </div>`;
        }
      }

      elQ.addEventListener("input", applyFilters);
      elCat.addEventListener("change", applyFilters);
      elOnlyActive.addEventListener("change", applyFilters);

      loadMenu();
    </script>
  </body>
</html>
